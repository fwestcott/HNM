---
title: "HNM TAG Analysis"
author: "Felix Westcott"
date: "2022-07-29"
output: html_document
---

```{r setup, include=MediaLSE}
library(tidyverse)
library(ggplot2)
library(readxl)
library(xlsx)
library(dplyr)
library(ggpubr)
library(ggsci)
library(rstatix)
library (cowplot)

All_Data <- read_excel("HNM TAG Analysis.xlsx", sheet = 2)

All_Data$"Condition" <- factor(All_Data$"Condition", levels = c("Low Insulin Control", "Low Insulin OPLA", "Low Insulin POLA", "High Insulin Control", "High Insulin OPLA", "High Insulin POLA"))

```

``` {R}

All_Data$"Round" <- as.numeric(All_Data$"Round")

All_Data$TAG <- All_Data$`Intracellular TAG (umol/g of protein)`
All_Data$PA <- All_Data$`Palmitate (mol %)`
All_Data$PAO <- All_Data$`Palmitoleate (mol %)`
All_Data$OA <- All_Data$`Oleate (mol %)`
All_Data$LA <- All_Data$`Linoleate (mol %)`


for (i in 15:ncol(All_Data)) {
   formula <- as.formula(paste(colnames(All_Data)[i], " ~ FA_Amount * FA_Type * Insulin * Round ", sep=""))
   model <- aov(formula, data = All_Data)

   cat("\n-----\n\n")
   cat(colnames(All_Data)[i])
   cat("\n")
   print(summary(model))
}

```

``` {R}

results <- TukeyHSD(aov(TAG ~ Condition, data = All_Data))
results_df <- separate(
  as.tibble(results$Condition, rownames = "Condition"), 
  Condition, into = c("group1", "group2"), sep = "-", convert = TRUE)
results_df$p_adj_signif <- if_else(results_df$`p adj` >= 0.05, "ns", 
                                   if_else(results_df$`p adj` >= 0.01, "*", 
                                           if_else(results_df$`p adj` >= 0.001, "**", "***")))
pairwise.test <- results_df[c(1,2,13,14),]

ggbarplot(All_Data, x = "Condition", "Intracellular TAG (umol/g of protein)",
    add = "mean_se", error.plot = "upper_errorbar", palette = "npg", legend = "none", fill = "Condition", ylab = "Intracellular TAG
(umol/g of protein)") +
  scale_y_continuous(expand = c(0,0), limits=c(0, 1500)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
theme(axis.text.x = element_text(color = "grey20", size = 12),
axis.text.y = element_text(color = "grey20", size = 14), 
axis.title.x = element_text(color = "grey20", size = 18),
axis.title.y = element_text(color = "grey20", size = 18)) +
  stat_pvalue_manual(pairwise.test, label = "p_adj_signif", y.position = 850, step.increase = 0.1)
ggsave('C:/Users/fwestcott/OneDrive - Nexus365/Desktop/Results/HNM/Graphs/TAG.png')

results <- TukeyHSD(aov(PA ~ Condition, data = All_Data))
results_df <- separate(
  as.tibble(results$Condition, rownames = "Condition"), 
  Condition, into = c("group1", "group2"), sep = "-", convert = TRUE)
results_df$p_adj_signif <- if_else(results_df$`p adj` >= 0.05, "ns", 
                                   if_else(results_df$`p adj` >= 0.01, "*", 
                                           if_else(results_df$`p adj` >= 0.001, "**", "***")))
pairwise.test <- results_df[c(2,3,6,14,15),]

ggbarplot(All_Data, x = "Condition", "Palmitate (mol %)",
    add = "mean_se", error.plot = "upper_errorbar", palette = "npg", legend = "none", fill = "Condition") +
  scale_y_continuous(expand = c(0,0), limits=c(0, 50)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
theme(axis.text.x = element_text(color = "grey20", size = 12),
axis.text.y = element_text(color = "grey20", size = 14), 
axis.title.x = element_text(color = "grey20", size = 18),
axis.title.y = element_text(color = "grey20", size = 18))+
  stat_pvalue_manual(pairwise.test, label = "p_adj_signif", y.position = 35, step.increase = 0.15)
ggsave('C:/Users/fwestcott/OneDrive - Nexus365/Desktop/Results/HNM/Graphs/Palmitate.png')

ggbarplot(All_Data, x = "Condition", "Palmitoleate (mol %)",
    add = "mean_se", error.plot = "upper_errorbar", palette = "npg", legend = "none", fill = "Condition") +
  scale_y_continuous(expand = c(0,0), limits=c(0, 5)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
theme(axis.text.x = element_text(color = "grey20", size = 12),
axis.text.y = element_text(color = "grey20", size = 14), 
axis.title.x = element_text(color = "grey20", size = 18),
axis.title.y = element_text(color = "grey20", size = 18))
ggsave('C:/Users/fwestcott/OneDrive - Nexus365/Desktop/Results/HNM/Graphs/Palmitoleate.png')

results <- TukeyHSD(aov(OA ~ Condition, data = All_Data))
results_df <- separate(
  as.tibble(results$Condition, rownames = "Condition"), 
  Condition, into = c("group1", "group2"), sep = "-", convert = TRUE)
results_df$p_adj_signif <- if_else(results_df$`p adj` >= 0.05, "ns", 
                                   if_else(results_df$`p adj` >= 0.01, "*", 
                                           if_else(results_df$`p adj` >= 0.001, "**", "***")))
pairwise.test <- results_df[c(2,6,14,15),]

ggbarplot(All_Data, x = "Condition", "Oleate (mol %)",
    add = "mean_se", error.plot = "upper_errorbar", palette = "npg", legend = "none", fill = "Condition") +
  scale_y_continuous(expand = c(0,0), limits=c(0, 100)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
theme(axis.text.x = element_text(color = "grey20", size = 12),
axis.text.y = element_text(color = "grey20", size = 14), 
axis.title.x = element_text(color = "grey20", size = 18),
axis.title.y = element_text(color = "grey20", size = 18)) +
  stat_pvalue_manual(pairwise.test, label = "p_adj_signif", y.position = 75, step.increase = 0.4)
ggsave('C:/Users/fwestcott/OneDrive - Nexus365/Desktop/Results/HNM/Graphs/Oleate.png')

results <- TukeyHSD(aov(LA ~ Condition, data = All_Data))
results_df <- separate(
  as.tibble(results$Condition, rownames = "Condition"), 
  Condition, into = c("group1", "group2"), sep = "-", convert = TRUE)
results_df$p_adj_signif <- if_else(results_df$`p adj` >= 0.05, "ns", 
                                   if_else(results_df$`p adj` >= 0.01, "*", 
                                           if_else(results_df$`p adj` >= 0.001, "**", "***")))
pairwise.test <- results_df[c(2,6,14,15),]

ggbarplot(All_Data, x = "Condition", "Linoleate (mol %)",
    add = "mean_se", error.plot = "upper_errorbar", palette = "npg", legend = "none", fill = "Condition") +
  scale_y_continuous(expand = c(0,0), limits=c(0, 15)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
theme(axis.text.x = element_text(color = "grey20", size = 12),
axis.text.y = element_text(color = "grey20", size = 14), 
axis.title.x = element_text(color = "grey20", size = 18),
axis.title.y = element_text(color = "grey20", size = 18)) +
  stat_pvalue_manual(pairwise.test, label = "p_adj_signif", y.position = 12, step.increase = 0.1)
ggsave('C:/Users/fwestcott/OneDrive - Nexus365/Desktop/Results/HNM/Graphs/Linoleate.png')

```

